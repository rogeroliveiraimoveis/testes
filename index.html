<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simula√ß√£o de Financiamento</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --p: #0056b3; --w: #25D366; --b: #f4f4f9; --wh: #ffffff; --t: #333333; --e: #d9534f; --g: #6c757d; }
        * { box-sizing: border-box; outline: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background-color: var(--b); 
            margin: 0; 
            padding: 10px; 
            display: flex; 
            justify-content: center; 
            /* Ajuste para mobile: Alinha ao topo para o teclado n√£o tampar o formul√°rio */
            align-items: flex-start; 
            min-height: 100vh; 
            color: var(--t); 
        }

        .c { 
            background: var(--wh); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,.08); 
            width: 100%; 
            max-width: 450px; 
            min-height: 420px; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
            /* Margem superior para n√£o colar no limite da tela */
            margin-top: 10px; 
        }

        h2 { text-align: center; margin: 0 0 20px 0; font-size: 1.1rem; color: #222; text-transform: uppercase; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .step { display: none; flex-direction: column; animation: fadeIn 0.3s ease; }
        .step.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .f-g { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: .95rem; color: #444; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; background: #fff; height: 50px; }
        .error-msg { color: var(--e); font-size: 0.85rem; margin-top: 5px; display: none; line-height: 1.3; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-next, .btn-send { flex: 2; padding: 16px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.2s; background-color: var(--p); color: #fff; }
        .btn-prev { flex: 1; padding: 16px; border: 1px solid #ccc; border-radius: 8px; font-size: 0.9rem; font-weight: bold; cursor: pointer; background-color: #eee; color: #555; text-transform: uppercase; }
        .btn-send { background-color: var(--w); box-shadow: 0 4px 10px rgba(37,211,102,.3); }
        .footer-info { margin-top: auto; text-align: center; font-size: 0.85rem; color: #777; padding-top: 20px; }
        .page-indicator { font-size: 0.8rem; color: #aaa; margin-top: 15px; text-align: center; }
        .sub-info { font-size: 0.85rem; color: #555; background: #f9f9f9; padding: 10px; border-radius: 8px; border-left: 4px solid var(--p); margin-bottom: 15px; }
        .legal-notice { font-size: 0.7rem; color: #999; margin-top: 10px; font-style: italic; }
    </style>
</head>
<body oncontextmenu="return false">

<div class="c">
    <h2>Simula√ß√£o de Financiamento</h2>

    <form id="simuForm">
        <div class="step active" id="step1">
            <div class="f-g">
                <label>Data de Nascimento</label>
                <input type="tel" id="nasc" placeholder="DD/MM/AAAA" maxlength="10" oninput="_mDt(this)" required>
                <div id="err-nasc" class="error-msg">Data inv√°lida ou futura.</div>
            </div>
            <div class="page-indicator">P√°gina 1 de 7</div>
        </div>

        <div class="step" id="step2">
            <div class="f-g">
                <label>Estado Civil</label>
                <select id="ec" onchange="handleECChange()">
                    <option value="">Selecione...</option>
                    <option value="Solteiro(a)">Solteiro(a)</option>
                    <option value="Casado(a)">Casado(a)</option>
                    <option value="Separado(a)">Separado(a)</option>
                    <option value="Divorciado(a)">Divorciado(a)</option>
                    <option value="Vi√∫vo(a)">Vi√∫vo(a)</option>
                    <option value="Uni√£o Est√°vel">Uni√£o Est√°vel</option>
                </select>
            </div>
            <div id="dynamic-ec" class="f-g"></div>
            <div class="btn-group">
                <button type="button" class="btn-prev" onclick="prevStep(2)">Voltar</button>
                <button type="button" class="btn-next" onclick="nextStep(2)">Continuar</button>
            </div>
            <div class="page-indicator">P√°gina 2 de 7</div>
        </div>

        <div class="step" id="step3">
            <div class="f-g"><label>Renda Bruta Pessoal</label><input type="text" id="rnd" placeholder="R$ 0,00" inputmode="numeric" onkeyup="_fM(this)"></div>
            <div class="f-g">
                <label>Tipo de Renda</label>
                <select id="tr">
                    <option value="Formal CLT">Formal CLT</option>
                    <option value="Informal / Aut√¥nomo">Informal / Aut√¥nomo</option>
                    <option value="Pr√≥ Labore">Pr√≥ Labore</option>
                    <option value="Misto (Formal + Informal)">Misto (Formal + Informal)</option>
                </select>
            </div>
            <div class="btn-group">
                <button type="button" class="btn-prev" onclick="prevStep(3)">Voltar</button>
                <button type="button" class="btn-next" onclick="nextStep(3)">Continuar</button>
            </div>
            <div class="page-indicator">P√°gina 3 de 7</div>
        </div>

        <div class="step" id="step4">
            <div class="f-g">
                <label>Declarou Imposto de Renda (IRPF/IRPJ)?</label>
                <select id="dir" onchange="handleIRChange()">
                    <option value="N√£o">N√£o</option>
                    <option value="Sim">Sim</option>
                </select>
            </div>
            <div id="ir-ano-cont" class="f-g" style="display:none">
                <label>Ano da √öltima Declara√ß√£o</label>
                <input type="number" id="air" placeholder="Ex: 2024">
                <div id="err-ir" class="error-msg"></div>
            </div>
            <div class="btn-group">
                <button type="button" class="btn-prev" onclick="prevStep(4)">Voltar</button>
                <button type="button" class="btn-next" onclick="nextStep(4)">Continuar</button>
            </div>
            <div class="page-indicator">P√°gina 4 de 7</div>
        </div>

        <div class="step" id="step5">
            <div class="f-g"><label>Saldo de FGTS Pessoal?</label><input type="text" id="fgts" placeholder="R$ 0,00" onkeyup="_fM(this)"></div>
            <div class="f-g">
                <label>Mais de 3 anos de contribui√ß√£o no FGTS?</label>
                <select id="tfg"><option value="N√£o">N√£o</option><option value="Sim">Sim</option></select>
            </div>
            <div class="btn-group">
                <button type="button" class="btn-prev" onclick="prevStep(5)">Voltar</button>
                <button type="button" class="btn-next" onclick="nextStep(5)">Continuar</button>
            </div>
            <div class="page-indicator">P√°gina 5 de 7</div>
        </div>

        <div class="step" id="step6">
            <div class="f-g">
                <label>Valor Dispon√≠vel (entrada/ato)?</label>
                <input type="text" id="ent" placeholder="R$ 0,00" onkeyup="_fM(this)">
                <div id="err-entrada" class="error-msg">Aten√ß√£o: O FGTS n√£o √© entrada. Informe o valor l√≠quido dispon√≠vel para pagamento imediato hoje.</div>
            </div>
            <div class="f-g">
                <label>Possui D√≠vidas / Acordos / Negocia√ß√µes?</label>
                <select id="div"><option value="N√£o">N√£o</option><option value="Sim">Sim</option></select>
            </div>
            <div class="btn-group">
                <button type="button" class="btn-prev" onclick="prevStep(6)">Voltar</button>
                <button type="button" class="btn-next" onclick="nextStep(6)">Continuar</button>
            </div>
            <div class="page-indicator">P√°gina 6 de 7</div>
        </div>

        <div class="step" id="step7">
            <button type="button" class="btn-send" onclick="_zRun()">üöÄ Enviar Respostas</button>
            <div class="btn-group"><button type="button" class="btn-prev" onclick="prevStep(7)" style="flex:1">Rever Informa√ß√µes</button></div>
            <div class="footer-info">
                <strong>Consultor: Roger Oliveira</strong><br>
                Creci-MG 45.117 ‚Äì WhatsApp (31) 93618-0070<br>
                <span style="color:var(--w); font-weight: bold;">‚úî Canal de Envio Seguro</span>
                <div class="legal-notice">Este documento possui dados para realiza√ß√£o de uma simula√ß√£o preliminar.</div>
            </div>
            <div class="page-indicator">P√°gina 7 de 7</div>
        </div>
    </form>
</div>

<script>
// --- PROTE√á√ÉO ---
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', function(e) {
    if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) || (e.ctrlKey && e.keyCode == 85)) {
        e.preventDefault(); return false;
    }
});

const _g = (id) => document.getElementById(id);

// --- M√ÅSCARAS ---
function _mDt(v) {
    let x = v.value.replace(/\D/g, "");
    if (x.length > 2) x = x.replace(/^(\d{2})(\d)/, "$1/$2");
    if (x.length > 5) x = x.replace(/^(\d{2})\/(\d{2})(\d)/, "$1/$2/$3");
    v.value = x;
    if (x.length === 10) {
        if (validarData(x)) { _g('err-nasc').style.display = 'none'; setTimeout(() => nextStep(1), 600); }
        else { _g('err-nasc').style.display = 'block'; }
    }
}

function _fM(i) {
    var v = i.value.replace(/\D/g, '');
    v = (v / 100).toFixed(2).replace(".", ",").replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
    i.value = "R$ " + v;
    if (i.id === 'ent') _g('err-entrada').style.display = 'none';
}

function validarData(data) {
    const p = data.split("/");
    const d = parseInt(p[0], 10), m = parseInt(p[1], 10)-1, a = parseInt(p[2], 10);
    const dt = new Date(a, m, d);
    return dt.getDate() === d && dt.getMonth() === m && dt < new Date() && a > 1920;
}

// --- NAVEGA√á√ÉO ---
function nextStep(c) {
    if (c === 2 && _g('ec').value === "") return alert("Selecione o estado civil.");
    if (c === 4 && _g('dir').value === "Sim") {
        const ano = parseInt(_g('air').value);
        const agora = new Date();
        if (ano > agora.getFullYear()) { _showErrIR("O ano n√£o pode ser no futuro."); return; }
        if (ano === agora.getFullYear() && agora.getMonth() + 1 < 3) { _showErrIR(`O per√≠odo de declara√ß√£o de ${agora.getFullYear()} ainda n√£o come√ßou.`); return; }
        _g('err-ir').style.display = 'none';
    }
    if (c === 6 && _g('ent').value !== "R$ 0,00" && _g('ent').value === _g('fgts').value) {
        _g('err-entrada').style.display = 'block'; return;
    }
    _g(`step${c}`).classList.remove('active');
    _g(`step${c + 1}`).classList.add('active');
    window.scrollTo(0,0); // Garante que a nova tela abra no topo
}

function _showErrIR(msg) { const e = _g('err-ir'); e.innerText = msg; e.style.display = 'block'; }
function prevStep(c) { _g(`step${c}`).classList.remove('active'); _g(`step${c - 1}`).classList.add('active'); window.scrollTo(0,0); }

function handleECChange() {
    const ec = _g('ec').value;
    const q = {
        "Solteiro(a)": "Confirma que n√£o possui div√≥rcio anterior? <br><br> <label>Comprar sozinho?</label><select id='cs'><option value='Sim'>Sim</option><option value='N√£o'>N√£o</option></select>",
        "Casado(a)": "Possui c√≥pia da Certid√£o de Casamento?<select id='sub_q'><option value='Sim'>Sim</option><option value='N√£o'>N√£o</option></select>",
        "Separado(a)": "Separa√ß√£o averbada na Certid√£o?<select id='sub_q'><option value='Sim'>Sim</option><option value='N√£o'>N√£o</option></select>",
        "Divorciado(a)": "Div√≥rcio averbado na Certid√£o?<select id='sub_q'><option value='Sim'>Sim</option><option value='N√£o'>N√£o</option></select>",
        "Vi√∫vo(a)": "Viuvez averbada na Certid√£o?<select id='sub_q'><option value='Sim'>Sim</option><option value='N√£o'>N√£o</option></select>",
        "Uni√£o Est√°vel": "Possui documento da uni√£o?<select id='sub_q'><option value='Sim'>Sim</option><option value='N√£o'>N√£o</option></select>"
    };
    _g('dynamic-ec').innerHTML = q[ec] ? `<div class='sub-info'>${q[ec]}</div>` : "";
}

function handleIRChange() { _g('ir-ano-cont').style.display = (_g('dir').value === "Sim") ? "block" : "none"; }

// --- PDF E WHATSAPP ---
function _zRun() {
    const d = {
        n: _g("nasc").value, c: _g("ec").value,
        sub: _g("sub_q") ? _g("sub_q").value : (_g("cs") ? "Sozinho: " + _g("cs").value : "--"),
        r: _g("rnd").value, t: _g("tr").value, ir: _g("dir").value, a: _g("air").value || "--",
        f: _g("fgts").value, e: _g("ent").value, tf: _g("tfg").value, dv: _g("div").value, h: new Date().toLocaleDateString("pt-BR")
    };
    _pG(d); _wS(d);
}

function _pG(o) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });
    doc.setFillColor(0, 86, 179); doc.rect(0, 0, 210, 45, 'F');
    doc.setTextColor(255, 255, 255); doc.setFont("helvetica", "bold"); doc.setFontSize(22);
    doc.text("SIMULA√á√ÉO DE FINANCIAMENTO", 105, 22, { align: "center" });
    doc.setFontSize(10); doc.text(`Gerado em: ${o.h}`, 105, 32, { align: "center" });
    let y = 60;
    const drawS = (t) => {
        doc.setFillColor(245, 245, 245); doc.rect(10, y-6, 190, 10, 'F');
        doc.setTextColor(0, 86, 179); doc.setFont("helvetica", "bold"); doc.text(t, 15, y+1); y += 15;
    };
    const addD = (l, v) => {
        doc.setTextColor(80); doc.setFont("helvetica", "bold"); doc.text(l, 15, y);
        doc.setTextColor(0); doc.setFont("helvetica", "normal"); doc.text(v, 90, y); y += 9;
    };
    drawS("DADOS DO CLIENTE");
    addD("Nascimento:", o.n); addD("Estado Civil:", o.c); addD("Adicional:", o.sub);
    y += 5; drawS("FINANCEIRO");
    addD("Renda:", o.r); addD("Tipo:", o.t); addD("IRPF:", o.ir + (o.ir==="Sim" ? " - " + o.a : ""));
    y += 5; drawS("RECURSOS");
    addD("FGTS:", o.f); addD("+3 Anos FGTS:", o.tf); addD("Entrada (Ato):", o.e); addD("D√≠vidas:", o.dv);
    doc.setFillColor(37, 211, 102); doc.rect(0, 250, 210, 47, 'F');
    doc.setTextColor(255); doc.setFontSize(14); doc.text("CONSULTOR: ROGER OLIVEIRA", 105, 263, { align: "center" });
    doc.setFontSize(11); doc.text("Creci-MG 45.117 | (31) 93618-0070", 105, 271, { align: "center" });
    doc.setFontSize(8); doc.setFont("helvetica", "italic");
    doc.text("Este documento possui dados para realiza√ß√£o de uma simula√ß√£o preliminar,", 105, 280, { align: "center" });
    doc.text("onde somente uma an√°lise efetiva pelo banco pode surtir (ou n√£o) em uma aprova√ß√£o de cr√©dito.", 105, 285, { align: "center" });
    doc.save(`Simulacao_Roger.pdf`);
}

function _wS(o) {
    const ph = "5531936180070";
    const msg = encodeURIComponent(
        `*NOVA SIMULA√á√ÉO DE FINANCIAMENTO*\n\n` +
        `*üë§ Nascimento:* ${o.n}\n*üíç Estado Civil:* ${o.c}\n*üìë Adicional:* ${o.sub}\n\n` +
        `*üí∞ Renda:* ${o.r} (${o.t})\n*üìÅ IR:* ${o.ir} (Ano: ${o.a})\n\n` +
        `*üè¶ FGTS:* ${o.f} (+3 anos: ${o.tf})\n*üíµ Entrada:* ${o.e}\n*‚ö†Ô∏è D√≠vidas:* ${o.dv}\n\n` +
        `_Este documento possui dados para realiza√ß√£o de uma simula√ß√£o preliminar, onde somente uma an√°lise efetiva pelo banco pode surtir (ou n√£o) em uma aprova√ß√£o de cr√©dito._`
    );
    const waUrl = `https://web.whatsapp.com/send?phone=${ph}&text=${msg}`;
    const fallbackUrl = `https://wa.me/${ph}?text=${msg}`;
    const win = window.open(waUrl, "_blank");
    if (!win || win.closed || typeof win.closed === 'undefined') { window.location.href = fallbackUrl; }
}
</script>
</body>
</html>
